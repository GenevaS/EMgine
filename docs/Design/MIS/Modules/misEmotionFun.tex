\section{Emotion Function Module (\mref{mEmotionFun}):
EmotionFunLib}\label{emotionFunModule}

The Emotion Function Library uses other function libraries, building compound
methods that can help automate tasks that users might not want to define
themselves such as calculating the next emotion state due to emotion decay
(\nfref{N_Auto}).

\subsection{Uses}
\begin{itemize}[noitemsep, nosep]

    \item EmotionStateT (Section~\ref{emotionstateModule})

    \item EmotionDecayStateT (Section~\ref{decayStateModule})

    \item EmDecayFunLib (Section~\ref{decayFunModule})

    \item EmotionT (Section~\ref{emotionModule})

    \item ITime(T, U) (Section~\ref{timeModule})

\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Access Programs}

\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{m{0.25\linewidth} m{0.22\linewidth} m{0.15\linewidth}
            m{0.28\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}CalcNextStateByDecay & EmotionT, TimeT(T),
        TimeT(T), $\mathbb{R}_{>0}$, \newline EmDecayStateT & EmotionStateT &
        W-EFL\_BAD\_TIME\_ORDER \\

        \bottomrule
    \end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{Access Routine Semantics}

\noindent CalcNextStateByDecay($e$, $\mathit{t1}$, $\mathit{t2}$, $c$,
$\mathit{decayState}$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{output: } out := \, \text{new EmotionStateT}&(i, m) &\\
            \text{where } i = ( \, \forall k \in & \, \text{EmotionTypesT}) \,
            | &\\
            i.k = \, &
            \text{DecayIntensity}(e.\text{GetEmotionStateAt}(\mathit{t2}),
            \text{Difference}(\mathit{t2}, \mathit{t1}), c, &\\
            & \mathit{decayState}.\text{GetDecayRateOf}(k), &\\
            & \mathit{decayState}.\text{GetEquilibriumOf}(k) ) \, ) &\\
            \text{and } m = ( \, \forall k \in & \, \text{EmotionTypesT}) \, |
            &\\
            m.k = \, &
            e.\text{GetEmotionStateAt}(\mathit{t2}).\text{GetMaxIntensityOf}(k)
            \, )
        \end{nospaceflalign*}
    }

    \item exception: $exc := ( \, \neg\text{IsAfter}(\mathit{t1}, \mathit{t2})
    \Rightarrow \text{W-EFL\_BAD\_TIME\_ORDER} \, )$

    \# IsAfter from ITime(T, U)

    \# Additional exceptions thrown from DecayIntensity, GetEmotionStateAt

\end{itemize}