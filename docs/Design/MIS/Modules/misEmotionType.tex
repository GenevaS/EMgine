\section{Emotion Type Module (\mref{mEmotionType}):
EmotionT}\label{emotionModule}
The Emotion ADT defines the emotion $\emotiontype$ data type, a time-ordered
sequence of emotion states.

\subsection{Uses}
\begin{itemize}[noitemsep, nosep]

    \item EmotionStateT (Section~\ref{emotionstateModule})

    \item ITime(T, U) (Section~\ref{timeModule})

\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Types}
\begin{itemize}

    \item EmotionT = Seq. of E, where E = Tuple of (TimeT(T), EmotionStateT)

\end{itemize}

\subsubsection{Exported Access Programs}

\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{m{0.23\linewidth} m{0.25\linewidth} m{0.16\linewidth}
            m{0.26\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}new EmotionT & -- & EmotionT & -- \\

        AddEmotionStateAt & TimeT(T), EmotionStateT & -- & E-E\_TIME\_OCCUPIED
        \\

        \rowcolor[gray]{0.9}RemoveEmotionStateAt & TimeT(T) & -- &
        E-E\_STATE\_DNE \\

        GetEmotionStateAt & TimeT(T) & EmotionStateT & E-E\_STATE\_DNE \\

        \rowcolor[gray]{0.9}UpdateEmotionStateAt & TimeT(T), EmotionStateT & --
        & W-E\_STATE\_DNE \\

        \bottomrule
    \end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}

    \item $\mathit{emotion} : \text{Seq. of E, where E = Tuple of } (t :
    \text{TimeT(T)}, \mathit{emState} : \text{EmotionStateT})$

\end{itemize}

\subsubsection{State Invariant}
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
        ( \; | \; \mathit{emotion} \; | = 0 &\Rightarrow \mathit{emotion} =
        \left< \right> &\\
        | \; | \; \mathit{emotion} \; | = 1 &\Rightarrow \mathit{emotion} =
        \left< (t : \text{ TimeT(T)}, e : \text{ EmotionStateT}) \right> &\\
        | \; | \; \mathit{emotion} \; | > 1 &\Rightarrow \forall i \in \left[
        0..| \; \mathit{emotion} \; | - 1 \right] \rightarrow
        \mathit{emotion}_i.t.\text{GetTime()} <
        \mathit{emotion}_{i+1}.t.\text{GetTime()} \; )
    \end{nospaceflalign*}
    }

\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent new EmotionT():
\begin{itemize}

    \item output: $out :=$ self

    \item transition: $\mathit{emotion} := \left< \right>$

    \item exception: None

\end{itemize}

\clearpage
\noindent AddEmotionStateAt($t$, $\mathit{state}$):
\begin{itemize}

    \item transition: $\mathit{emotion} := $\vspace*{0.5em}
    \begin{nospaceflalign*}
        &\parbox{\linewidth}{$( \; \exists i, j \rightarrow
        \mathit{emotion}[i].t.\text{GetTime()} < t.\text{GetTime()} <
        \mathit{emotion}[j].t.\text{GetTime()} \\ \wedge
        \nexists k \rightarrow \mathit{emotion}[i].t.\text{GetTime()} <
        \mathit{emotion}[k].t.\text{GetTime()} <
        \mathit{emotion}[j].t.\text{GetTime()} \\ \Rightarrow
        \mathit{emotion}[0..i] \, || \,
        (t, \mathit{state}) \, || \, \mathit{emotion}[j..|\, \mathit{emotion}
        \, | - 1]$} &\\
        &| \; t.\text{GetTime()} < \mathit{emotion}[0].t.\text{GetTime()}
        \Rightarrow (t, \mathit{state}) \, || \, \mathit{emotion} &\\
        &| \; t.\text{GetTime()} > \mathit{emotion}[j..|\, \mathit{emotion}
        \, | - 1].t.\text{GetTime()} \Rightarrow \mathit{emotion} \, || \,
        (t, \mathit{state}) &\\
        &| \; \mathit{emotion} = \left< \right> \Rightarrow \left< \, (t,
        \mathit{state}) \, \right> \; )
    \end{nospaceflalign*}

    \item exception: $exc := ( \, \exists e \in \mathit{emotion} \rightarrow
    e.t.\text{GetTime()} = t.\text{GetTime()} \Rightarrow
    \text{E-E\_TIME\_OCCUPIED} \, )$

\end{itemize}

\noindent RemoveEmotionStateAt($t$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{transition: } ( \, \exists i \in [0..|\, \mathit{emotion} \,
            | - 1] &\wedge \mathit{emotion}[i].t.\text{GetTime()} =
            t.\text{GetTime()} &\\
            &\Rightarrow \mathit{emotion} := \mathit{emotion}[0..i - 1] \, ||
            \, \mathit{emotion}[i + 1..|\, \mathit{emotion} \, | - 1] \, )
        \end{nospaceflalign*}
    }

    \item exception: $exc := ( \, \nexists e \in \mathit{emotion} \rightarrow
    e.t.\text{GetTime()} = t.\text{GetTime()} \Rightarrow
    \text{E-E\_STATE\_DNE} \, )$

\end{itemize}

\noindent GetEmotionStateAt($t$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{output: } out := ( \, \exists i \in [0..|\, \mathit{emotion}
            \, | - 1] &\wedge \mathit{emotion}[i].t.\text{GetTime()} =
            t.\text{GetTime()} &\\
            &\Rightarrow \mathit{emotion}[i].\mathit{emState} \, )
        \end{nospaceflalign*}
    }

    \item exception: $exc := ( \, \nexists e \in \mathit{emotion} \rightarrow
    e.t.\text{GetTime()} = t.\text{GetTime()} \Rightarrow
    \text{E-E\_STATE\_DNE} \, )$

\end{itemize}

\noindent UpdateEmotionStateAt($t$, $\mathit{state}$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{transition: } ( \, \exists i \in [0..|\, \mathit{emotion} \,
            | - 1] &\wedge \mathit{emotion}[i].t.\text{GetTime()} =
            t.\text{GetTime()} &\\
            &\Rightarrow \mathit{emotion}[i].\mathit{emState} :=
            \mathit{state} \, )
        \end{nospaceflalign*}
    }

    \item exception: $exc := ( \, \nexists e \in \mathit{emotion} \rightarrow
    e.t.\text{GetTime()} = t.\text{GetTime()} \Rightarrow
    \text{W-E\_STATE\_DNE} \, )$

\end{itemize}