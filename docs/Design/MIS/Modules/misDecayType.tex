\section[Emotion Intensity Decay Module (\mref{mDecay}): EmIntensityDecayT,
EmDecayFunLib(U), and EmDecayFunParamsT(U)]{Emotion Intensity Decay Module
(\mref{mDecay}): EmIntensityDecayT, \\ EmDecayFunLib(U), and
EmDecayFunParamsT(U)}\label{decayModule}

The Emotion Intensity Decay Rate Module defines the emotion intensity decay rate
$\emotiondecaytype$ data type and the function library for performing emotion
intensity decay. They are defined in the same module because the underlying
models for decay functions dictate the constraints on $\emotiondecaytype$. An
additional sub module, EmDecayFunParamsT(U), allows users to choose to track
decay time manually and provide the total time elapsed since emotion decay
began, or to automate it by storing a DeltaTimeT(U) such that users only need
to provide the elapsed time since the last decay evaluation.

Emotion intensity decay is based on damped harmonic oscillator behaviours. The
type of $\emotiondecaytype$ is a real-valued, strictly positive constant
equivalent to the spring constant $k_s$. A default decay rate of $1.0$ is
available, corresponding with a critically damped system response (i.e. returns
to equilibrium as quickly as possible with no oscillations).

The design of EmIntensityDecayT ($\emotiondecaytype$) is application-agnostic
and can exist independently of \progname{}. EmDecayFunLib can exist outside of
\progname{} iff EmIntensityT and DeltaTimeT(U) or equivalent are available.

\subsection{Uses (Excluding EmIntensityDecayT)}
\begin{itemize}[noitemsep, nosep]

    \item EmIntensityT, EmIntensityChgT (Section~\ref{intensityModule})

    \item DeltaTimeT(U) (Section~\ref{timeModule})

\end{itemize}

\subsection{Syntax: EmIntensityDecayT}

\subsubsection{Exported Constants}
\begin{itemize}

    \item EM\_DECAY\_RATE\_DEFAULT = 1.0

\end{itemize}

\subsubsection{Exported Types}
\begin{itemize}

    \item EmDecayRateT = $\left\{ \, \mathit{decayRate} : \mathbb{R} \; | \;
    \mathit{decayRate} > 0 : \mathit{decayRate} \, \right\}$

\end{itemize}

\subsubsection{Exported Access Programs}
\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \small
    \begin{tabular}{m{0.27\linewidth} m{0.14\linewidth} m{0.14\linewidth}
            m{0.34\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}new EmDecayRateT & $ \mathbb{R}_{>0} $ &
        EmDecayRateT & W-EDR\_ILLEGAL\_DECAY\_RATE \\

        CompareToDecayRate & EmDecayRateT & $\mathbb{Z}$ & -- \\

        \rowcolor[gray]{0.9}CompareToDefaultDecayRate & -- & $\mathbb{Z}$ & --
        \\

        ResetDecayRate & -- & -- & -- \\

        \bottomrule
    \end{tabular}
\end{center}

\subsubsection{Local Access Programs}
\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \small
    \begin{tabular}{m{0.27\linewidth} m{0.14\linewidth} m{0.14\linewidth}
            m{0.34\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}GetDecayRate & -- & $\mathbb{R}$ & -- \\

        \bottomrule
    \end{tabular}
\end{center}

\clearpage\subsection{Semantics: EmIntensityDecayT}

\subsubsection{State Variables}
\begin{itemize}

    \item $\mathit{decayRate}$ : $ \mathbb{R}_{>0} $

\end{itemize}

\subsubsection{State Invariant}
\begin{itemize}

    \item $ 0 < \mathit{decayRate} $

\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent new EmDecayRateT($\mathit{lambda}$):
\begin{itemize}

    \item output: $out :=$ self

    \item transition: $\mathit{decayRate} := \mathit{lambda}$

    \item exception: $exc := ( \, \mathit{lambda} \leq 0 \Rightarrow
    \text{W-EDR\_ILLEGAL\_DECAY\_RATE} \, )$

\end{itemize}

\noindent CompareToDecayRate($\mathit{lambda}$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{output: } \mathit{out := } \, ( \; | \, &C \, | \, \leq
            \epsilon \Rightarrow 0 \; | \; C > \epsilon \Rightarrow 1 \; | \;
            C < -\epsilon \Rightarrow -1 \; ) &\\
            \text{where } &C = \mathit{lambda} - i.\text{GetDecayRate()}
        \end{nospaceflalign*}
    }

    \item exception: None

\end{itemize}

\noindent CompareToDefaultDecayRate():
\begin{itemize}

    \item output: $out := $ CompareToDecayRate(EM\_DECAY\_RATE\_DEFAULT)

    \item exception: None

\end{itemize}

\noindent ResetDecayRate():
\begin{itemize}

    \item transition: $\mathit{decayRate} := \text{EM\_DECAY\_RATE\_DEFAULT}$

    \item exception: None

\end{itemize}

\subsubsection{Local Functions}

\noindent GetDecayRate():
\begin{itemize}

    \item output: $out := \mathit{decayRate}$

    \item exception: None

\end{itemize}

\clearpage\subsection{Syntax: EmDecayFunLib(U)}

\subsubsection{Exported Access Programs}

\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \small
    \begin{tabular}{m{0.21\linewidth} m{0.18\linewidth} m{0.18\linewidth}
            m{0.32\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}DecayIntensity & EmIntensityT, \newline
        DeltaTimeT(U), \newline EmIntensityDecayT, \newline $\mathbb{R}_{>0}$,
        EmIntensityT & EmIntensityT & W-EDR\_NEGATIVE\_TIME\_DELTA, \newline
        E-EDR\_ILLEGAL\_ZETA \\

        CalcDecayRateFrom & $\mathbb{R}_{>0}$, $\mathbb{R}_{>0}$ &
        EmIntensityDecayT & E-EDR\_ILLEGAL\_DECAY\_CONST, \newline
        E-EDR\_ILLEGAL\_ZETA \\

        \rowcolor[gray]{0.9}CalcZetaFrom & EmIntensityDecayT, \newline
        $\mathbb{R}_{>0}$ & $(\mathbb{R}_{>0})^?$ &
        E-EDR\_ILLEGAL\_DECAY\_CONST \\

        \bottomrule
    \end{tabular}
\end{center}

\subsubsection{Local Access Programs}

\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \small
    \begin{tabular}{m{0.21\linewidth} m{0.18\linewidth} m{0.18\linewidth}
            m{0.32\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}UnderDampedDecay & EmIntensityChgT, \newline
        $\mathbb{R}$, $\mathbb{R}_{>0}$, $\mathbb{R}_{>0}$ & EmIntensityT & --
        \\

        CriticallyDampedDecay & EmIntensityChgT, \newline $\mathbb{R}$,
        $\mathbb{R}_{>0}$ & EmIntensityT & -- \\

        \rowcolor[gray]{0.9}OverDampedDecay & EmIntensityChgT, \newline
        $\mathbb{R}$, $\mathbb{R}_{>0}$, $\mathbb{R}_{>0}$ & EmIntensityT & --
        \\

        \bottomrule
    \end{tabular}
\end{center}

\subsubsection{Assumptions}
\begin{itemize}
    \item The concrete type of U is the same as the concrete type of U in
    DeltaTimeT(U)
\end{itemize}

\subsection{Semantics: EmDecayFunLib(U)}

\subsubsection{Access Routine Semantics}

\noindent DecayIntensity($\mathit{i}$, $\mathit{deltaTime}$,
$\mathit{decayRate}$, $\zeta$, $\mathit{iEq}$):
\begin{itemize}

    \item output: $out := X.\text{SumWithIntensity}(\mathit{iEq}) $
    $$\text{where } X = \begin{cases}
        \text{UnderDampedDecay}(x_0, t, \zeta, \omega_n), & \zeta < 1.0 \\
        \text{CriticallyDampedDecay}(x_0, t, \omega_n), & \zeta = 1.0 \\
        \text{OverDampedDecay}(x_0, t, \zeta, \omega_n), & \zeta > 1.0 \\
    \end{cases}$$

    \begin{center}
        where $x_0 = i$.Difference($\mathit{iEq}$), $t =
        \mathit{deltaTime}$.ConvertToValue(), and $\omega_n =
        \sqrt{\mathit{decayRate}}$
    \end{center}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{exception: } \mathit{exc := } \, (& \; \zeta \leq 0
            \Rightarrow \text{E-EDR\_ILLEGAL\_ZETA} &\\
            |& \; \mathit{deltaTime}.\text{IsNegative}() = \True  \Rightarrow
            \text{W-EDR\_NEGATIVE\_TIME\_DELTA} \; )
        \end{nospaceflalign*}
    }

\end{itemize}

\clearpage\noindent CalcDecayRateFrom($\mathit{c}$, $\zeta$):
\begin{itemize}

    \item transition: $\mathit{decayRate} := \dfrac{c^{2.0}}{4.0 \cdot
        \zeta^{2.0}}$

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{exception: } \mathit{exc := } \, (& \; \mathit{c} \leq 0
            \Rightarrow \text{E-EDR\_ILLEGAL\_DECAY\_CONST} &\\
            |& \; \zeta \leq 0  \Rightarrow
            \text{E-EDR\_ILLEGAL\_ZETA} \; )
        \end{nospaceflalign*}
    }

\end{itemize}

\noindent CalcZetaFrom($d, c$):
\begin{itemize}

    \item output: $out := \dfrac{c}{2.0 \cdot \sqrt{d.\text{GetDecayRate()}}}$

    \item exception: $exc := ( \, \mathit{c} \leq 0 \Rightarrow
    \text{E-EDR\_ILLEGAL\_DECAY\_CONST} \, )$

\end{itemize}

\subsubsection{Local Functions}

\noindent UnderDampedDecay($\mathit{x_0}$, $t$, $\zeta$, $\omega_n$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{output: } \mathit{out := } \,
            \mathit{x_0}.&\text{MultiplyByValue}(\cos(\omega \cdot t)) &\\
            &.\text{SumWithChg}\left(\mathit{x_0}.\text{MultiplyByValue}
            \left(\dfrac{r}{\omega} \cdot \sin(\omega \cdot t)\right)\right) &\\
            &.\text{MultiplyByValue}\left(e^{\text{\mbox{\footnotesize $-1.0
            \cdot r \cdot t$}}}\right) &\\
            &\text{where } \omega = \omega_n \cdot \sqrt{1.0 - \zeta^2}
            \text{ and } r = \omega_n \cdot \zeta
        \end{nospaceflalign*}
    }

    \item exception: None

\end{itemize}

\noindent CriticallyDampedDecay($\mathit{x_0}$, $t$, $\omega_n$):
\begin{itemize}

    \item output: $out := \mathit{x_0}.\text{SumWithChg}
    (x_0.\text{MultiplyByValue}(\omega_n \cdot
    t)).\text{MultiplyByValue}\left(e^{\text{\mbox{\footnotesize $-1.0 \cdot
    \omega_n \cdot t$}}}\right)$

    \item exception: None

\end{itemize}

\noindent UnderDampedDecay($\mathit{x_0}$, $t$, $\zeta$, $\omega_n$):
\begin{itemize}

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{output: } \mathit{out := } \,
            \mathit{x_0}.&\text{SumWithChg}
            \left(\mathit{x_0}.\text{MultiplyByValue}\left(
            \dfrac{\zeta}{\sqrt{\zeta^2 -
            1.0}}\right)\right).\text{MultiplyByValue}(0.5) &\\
            &.\text{MultiplyByValue}\left(e^{\text{\mbox{\footnotesize $-1.0
            \cdot \left(\omega_n \cdot \zeta - \, \omega\right) \cdot
            t$}}}\right) &\\
            &.\text{SumWithChg}\left(\mathit{x_0}.\text{MultiplyByValue}\left(
            \dfrac{-1.0 \cdot \zeta}{\sqrt{\zeta^2 -
            1.0}}\right)\right).\text{MultiplyByValue}(0.5) &\\
            &.\text{MultiplyByValue}\left(e^{\text{\mbox{\footnotesize $-1.0
            \cdot \left(\omega_n \cdot \zeta + \, \omega\right) \cdot
            t$}}}\right) &\\
            &\text{where } \omega = \omega_n \cdot \sqrt{\zeta^2 - 1.0}
        \end{nospaceflalign*}
    }

    \item exception: None

\end{itemize}

\clearpage

\subsection{Syntax: EmDecayFunParamsT(U)}
\subsubsection{Exported Access Programs}
\begin{center}
    \renewcommand{\arraystretch}{1.2}
    \small
    \begin{tabular}{m{0.27\linewidth} m{0.18\linewidth} m{0.12\linewidth}
            m{0.32\linewidth}}
        \toprule
        \textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
        \midrule

        \rowcolor[gray]{0.9}new EmDecayFunParamsT(U) & DeltaTimeT(U) & -- &
        W-EDR\_NEGATIVE\_TIME\_DELTA \\

        UpdateTime & DeltaTimeT(U) & -- & W-EDR\_NEGATIVE\_TIME\_DELTA \\

        \rowcolor[gray]{0.9}DecayIntensity & EmIntensityT, \newline
        DeltaTimeT(U), \newline EmIntensityDecayT, \newline $\mathbb{R}_{>0}$,
        EmIntensityT & EmIntensityT & -- \\

        \bottomrule
    \end{tabular}
\end{center}

\subsubsection{Assumptions}
\begin{itemize}
    \item The concrete type of U is the same as the concrete type of U in
    DeltaTimeT(U)
\end{itemize}

\subsection{Semantics: EmDecayFunParamsT(U)}

\subsubsection{State Variables}
\begin{itemize}

    \item $\mathit{time}$ : DeltaTimeT(U)

\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent new EmDecayFunParamsT(U)($\mathit{deltaTimeStart}$):
\begin{itemize}

    \item output: $out := $ self

    \item transition: $\mathit{time} := \mathit{deltaTimeStart}$

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{exception: } \mathit{exc := } \, ( \;
            \mathit{time}.\text{SumWith}(\mathit{deltaTimeStep})
            .&\text{IsNegative}() = \True &\\
            &\Rightarrow \text{W-EDR\_NEGATIVE\_TIME\_DELTA} \; )
        \end{nospaceflalign*}
    }

\end{itemize}

\noindent UpdateTime($\mathit{deltaTimeStep}$):
\begin{itemize}

    \item transition: $\mathit{time} :=
    \mathit{time}.\text{SumWith}(\mathit{deltaTimeStep}) $

    \item \parbox[t]{\linewidth}{\vspace*{-1.2em}\begin{nospaceflalign*}
            \text{exception: } \mathit{exc := } \, ( \;
            \mathit{time}.\text{SumWith}(\mathit{deltaTimeStep})
            .&\text{IsNegative}() = \True &\\
            &\Rightarrow \text{W-EDR\_NEGATIVE\_TIME\_DELTA} \; )
        \end{nospaceflalign*}
    }

\end{itemize}

\noindent DecayIntensity($\mathit{i}$, $\mathit{decayRate}$, $\zeta$,
$\mathit{iEq}$):
\begin{itemize}

    \item output: $out := $ DecayIntensity($\mathit{i}$, $\mathit{time}$,
    $\mathit{decayRate}$, $\zeta$, $\mathit{iEq}$)

    \# DecayIntensity from EmDecayFunLib(U)

    \item exception: None

\end{itemize}